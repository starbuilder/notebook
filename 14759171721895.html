<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Firebase Auth - Email login - Andy程式筆記
  
  </title>
 <meta name="description" content="記錄平常碰到的問題。">
 <link href="atom.xml" rel="alternate" title="Andy程式筆記" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">Andy程式筆記</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Andy程式筆記</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>Android</label></li>

          
            <li><a title="FireBase-Android" href="14759179598313.html">FireBase-Android</a></li>
          
            <li><a title="Firebase Auth - Facebook login" href="14759172328306.html">Firebase Auth - Facebook login</a></li>
          
            <li><a title="Firebase Auth - Google login" href="14759172090787.html">Firebase Auth - Google login</a></li>
          
            <li><a title="Firebase Auth - Email login" href="14759171721895.html">Firebase Auth - Email login</a></li>
          
            <li><a title="Android 用Post方式開啟外部瀏覽器" href="14745560509829.html">Android 用Post方式開啟外部瀏覽器</a></li>
          

      
        <li class="divider"></li>
        <li><label>Mac</label></li>

          
            <li><a title="On My Zsh" href="14745562093269.html">On My Zsh</a></li>
          
            <li><a title="PHP安裝" href="14745560878356.html">PHP安裝</a></li>
          
            <li><a title="Mysql 設定" href="14745560868116.html">Mysql 設定</a></li>
          
            <li><a title="Apache 2.4 confing 設定" href="14745560857876.html">Apache 2.4 confing 設定</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>Android</span></li>
                        
                          <li><a title="FireBase-Android" href="14759179598313.html">FireBase-Android</a></li>
                        
                          <li><a title="Firebase Auth - Facebook login" href="14759172328306.html">Firebase Auth - Facebook login</a></li>
                        
                          <li><a title="Firebase Auth - Google login" href="14759172090787.html">Firebase Auth - Google login</a></li>
                        
                          <li><a title="Firebase Auth - Email login" href="14759171721895.html">Firebase Auth - Email login</a></li>
                        
                          <li><a title="Android 用Post方式開啟外部瀏覽器" href="14745560509829.html">Android 用Post方式開啟外部瀏覽器</a></li>
                        

                    
                      <li class="side-title"><span>Mac</span></li>
                        
                          <li><a title="On My Zsh" href="14745562093269.html">On My Zsh</a></li>
                        
                          <li><a title="PHP安裝" href="14745560878356.html">PHP安裝</a></li>
                        
                          <li><a title="Mysql 設定" href="14745560868116.html">Mysql 設定</a></li>
                        
                          <li><a title="Apache 2.4 confing 設定" href="14745560857876.html">Apache 2.4 confing 設定</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>Firebase Auth - Email login</h1>

<h3 id="toc_0">直接輸入Email和密碼註冊登入</h3>

<ul>
<li>1. 進入專案管理<img src="media/14759171721895/%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-10-08%20%E4%B8%8B%E5%8D%885.06.58.png" alt="螢幕快照 2016-10-08 下午5.06.58"/></li>
<li>2.進入Auth管理-&gt;登入方式-&gt;啟用電子郵件/密碼
<img src="media/14759171721895/%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-10-08%20%E4%B8%8B%E5%8D%885.09.09.png" alt="螢幕快照 2016-10-08 下午5.09.09"/></li>
<li>3.建立Ａndroid Project並且已經加入FireBase(不知道怎麼做可以參考<a href="%5BFireBase-Android%5D(mweblib://14759179598313)">FireBase-Android Start up</a>)</li>
<li>4.導入FireBase的Auth library</li>
</ul>

<pre><code>compile &#39;com.google.firebase:firebase-auth:9.6.1&#39;
</code></pre>

<ul>
<li><p>5.然後開始寫登入流程的code</p>

<p>取得FirebaseAuth這個最主要的物件,登入流程都會用到它</p></li>
</ul>

<pre><code>//取得FirebaseAuth 
private FirebaseAuth mAuth;

mAuth = FirebaseAuth.getInstance();
</code></pre>

<ul>
<li>6. 建立FirebaseAuth.AuthStateListener監聽Auth狀態變化</li>
</ul>

<pre><code>mAuthListener = new FirebaseAuth.AuthStateListener() {
        @Override
        public void onAuthStateChanged(@NonNull FirebaseAuth firebaseAuth) {
            FirebaseUser user = firebaseAuth.getCurrentUser();
            if (user != null) {
                // User is signed in
                Log.d(TAG, &quot;onAuthStateChanged:signed_in:&quot; + user.getUid());
            } else {
                // User is signed out
                Log.d(TAG, &quot;onAuthStateChanged:signed_out&quot;);
            }
          
        }
    };
      // ...
 @Override
public void onStart() {
    super.onStart();
    //可以在onStart時,加入FirebaseAuth.AuthStateListener
    mAuth.addAuthStateListener(mAuthListener);
}

@Override
public void onStop() {
    super.onStop();
    //可以在onStop時,移除FirebaseAuth.AuthStateListener
    if (mAuthListener != null) {
        mAuth.removeAuthStateListener(mAuthListener);
    }
}

</code></pre>

<ul>
<li>7.第一次登入要先註冊帳號,使用FirebaseAuth的mAuth.createUserWithEmailAndPassword,直接給email, password兩個參數,然後在addOnCompleteListener接到完成的callback,可以透過回傳得task.isSuccessful()物件判斷登入是否成功,如果失敗可以用task.getException().toString()印出錯誤訊息來看原因.</li>
</ul>

<pre><code>mAuth.createUserWithEmailAndPassword(email, password)
        .addOnCompleteListener(this, new OnCompleteListener&lt;AuthResult&gt;() {
            @Override
            public void onComplete(@NonNull Task&lt;AuthResult&gt; task) {
                Log.d(TAG, &quot;createUserWithEmail:onComplete:&quot; + 
                if (!task.isSuccessful()) {
                    Toast.makeText(EmailPasswordActivity.this,      R.string.auth_failed,
                            Toast.LENGTH_SHORT).show();
                }

                // ...
            }
        });

</code></pre>

<ul>
<li>8.已經註冊過了直接登入,使用FirebaseAuth的mAuth.signInWithEmailAndPassword,同上做法一樣</li>
</ul>

<pre><code>mAuth.signInWithEmailAndPassword(email, password)
        .addOnCompleteListener(this, new OnCompleteListener&lt;AuthResult&gt;() {
            @Override
            public void onComplete(@NonNull Task&lt;AuthResult&gt; task) {
             
                if (!task.isSuccessful()) {
                    Log.w(TAG, &quot;signInWithEmail:failed&quot;, task.getException());
                    Toast.makeText(EmailPasswordActivity.this, R.string.auth_failed,
                            Toast.LENGTH_SHORT).show();
                }

                // ...
            }
        });
</code></pre>

<ul>
<li>9. 可以透過mAuth.getCurrentUser()是否為 null,來判斷是否已經登入.</li>
</ul>

<pre><code>if(mAuth.getCurrentUser()==null){
    loginButton.setText(&quot;Login&quot;);
}else{
    loginButton.setText(&quot;Login out&quot;);
}
</code></pre>

<ul>
<li>10.登入會發現取得FirebaseUser的 displayName是null,可以用以下code去更新displayName,同時也可以設定一些使用者的個人設定,例如大頭貼...</li>
</ul>

<pre><code> UserProfileChangeRequest profileUpdates = new UserProfileChangeRequest.Builder()
                .setDisplayName(nickName)
                .build();
        user.updateProfile(profileUpdates)
                .addOnCompleteListener(new OnCompleteListener&lt;Void&gt;() {
                    @Override
                    public void onComplete(@NonNull Task&lt;Void&gt; task) {
                        if (task.isSuccessful()) {
                            Log.d(TAG, &quot;User profile updated.&quot;);
                            finish();
                        }
                    }
                });
</code></pre>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="14759179598313.html"  title="Previous Post: FireBase-Android">&laquo; FireBase-Android</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="14759172328306.html" 
	        title="Next Post: Firebase Auth - Facebook login">Firebase Auth - Facebook login &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '14759171721895.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  </body>
</html>
